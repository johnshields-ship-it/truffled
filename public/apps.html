<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="icon" type="image/png" href="png/logo.png"/>
      <title>Truffled - Apps</title>
      <meta name="title" content="Truffled - Interactive Learning Resources">
      <meta name="description" content="Truffled is an educational platform offering interactive activities, brain-training challenges, and creative learning tools for students.">
      <meta property="og:type" content="website">
      <meta property="og:url" content="https://truffled.lol/">
      <meta property="og:title" content="Truffled - Interactive Learning Resources">
      <meta property="og:description" content="Explore engaging educational content, problem-solving challenges, and interactive tools designed to support learning.">
      <meta property="og:image" content="https://truffled.lol/png/logo.png">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:url" content="https://truffled.lol/">
      <meta name="twitter:title" content="Truffled - Interactive Learning Resources">
      <meta name="twitter:description" content="A safe and clean educational site offering interactive activities and learning-focused tools.">
      <meta name="twitter:image" content="https://truffled.lol/png/logo.png">
      <link rel="canonical" href="https://truffled.lol/">
      <link rel="stylesheet" href="css/style.css">
      <link rel="stylesheet" href="css/h.css">
      <link rel="stylesheet" href="css/auto.css">
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
   </head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PXHK7Q7G3Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-PXHK7Q7G3Z');
</script>
   <body>
      <div class="navbar-right">
          <a href="/"><img src="png/house-solid.svg" alt="h"></a>
          <a href="g"><img src="png/gamepad-solid.svg" alt="g"></a>
          <a href="a"><img src="png/apps.svg" alt="a"></a>
          <a href="t"><img src="png/tool.svg" alt="t"></a>
          <a href="https://discord.gg/vVqY36mzvj"><img src="png/other.svg" alt="d"></a>
          <a href="s"><img src="png/gear-solid.svg" alt="s"></a>
      </div>
      <div class="content">
         <h4>Apps</h4>
         <div id="searchCount" style="color: #ffffff; text-align: center; font-family: 'Poppins', sans-serif; font-size: 1.2rem; font-weight: 600; letter-spacing: 0.5px;">Loading apps...</div>
         <input type="text" id="searchInput" class="search-bar" placeholder="Search apps...">
         <div id="autocomplete" class="autocomplete-list"></div>
         <div class="container">
            <div class="game-gallery" id="gameGallery"></div>
         </div>
      </div>
      <script src="js/cloak.js"></script>
      <script src="/js/panic.js"></script>
      <script src="/js/search.js"></script>
      <script src="/js/right.js"></script>
      <script src="/js/mobile.js"></script>
      <script src="/baremux/index.js"></script>
      <script>
         class AppLoader {
         constructor() {
             this.apps = [];
             this.totalApps = 0;
             this.popularApps = [
                 "Youtube",
                 "Discord",
                 "Tiktok",
                 "Saavn (Music)",
                 "Snapchat"
             ];
            this.connection = new BareMux.BareMuxConnection("/baremux/worker.js")
         }
         async init() {
             try {
                 await this.connection.setTransport("/libcurl/index.mjs", [{ wisp: (location.protocol === "https:" ? "wss" : "ws") + "://" + location.host + "/wisp/" }]);
                 await this.directSetIp();
                 await this.loadApps();
                 this.renderApps();
                 this.setupSearch();
                 this.updateAppCount();
                 
             } catch (err) {
                 console.error('app load error', err);
                 this.showError('refresh to fix');
             }
         }
         async directSetIp() {
            
             try {
                 const res = await fetch('/ip');
                 if (!res.ok) throw new Error('fetch failed');
                 const ip = await res.text();
                 sessionStorage.setItem("prefix", ip);
             } catch (err) {
                 console.error('IP fetch error:', err);
             }
         }
         async loadApps() {
             try {
                 const response = await fetch('/js/json/a.json');
                 if (!response.ok) throw new Error('a.json not found');
                 const data = await response.json();
                 this.apps = data.apps || data.games || [];
                 this.totalApps = this.apps.length;
             } catch (err) {
                 console.error('error loading:', err);
                 throw err;
             }
         }
         
         getAppUrl(app) {
             let url = app.url;
             if (app.requiresPrefix) {
                 const prefix = sessionStorage.getItem("prefix") || '';
                 url = url.replace('{prefix}', prefix);
             }
             if (typeof transformGameUrl === 'function') {
                 url = transformGameUrl(url);
             }
             
             return url;
         }
         getFramePage(url) {
             if (url.includes('/mobile.html?url=')) {
                 return '/iframe.html';
             }            
             const app = this.apps.find(a => url.includes(a.url.split('?')[0]));
             const frameType = app?.frameType || 'iframe';
             return frameType === 'unity' ? '/unityframe.html' : '/iframe.html';
         }
         
         renderApps() {
             const gallery = document.getElementById('gameGallery');
             if (!gallery) return;
             gallery.innerHTML = '';
             this.apps.forEach(app => {
                 const appCard = this.createAppCard(app);
                 gallery.appendChild(appCard);
             });
         }
         createAppSuggestionCard() {
             const div = document.createElement('div');
             div.className = 'game';
             div.setAttribute('data-name', 'App Suggestions');
             div.innerHTML = `
                 <a href="https://forms.gle/azBWo53JQN8VNzFt5" class="game-link" data-name="App Suggestions">
                 <img src="/png/games/forms.webp" alt="App Suggestions" class="game-thumbnail">
                 </a>
             `;
             return div;
         }
         createRandomAppCard() {
             const div = document.createElement('div');
             div.className = 'game';
             div.setAttribute('data-name', 'Random app');
             div.onclick = () => this.pickRandomApp();
             div.innerHTML = `
                 <a href="javascript:void(0);" class="game-link" data-name="Random app">
                 <video src="png/vid/random.gif" autoplay muted loop playsinline class="game-thumbnail"></video>
                 </a>
             `;
             return div;
         }
         createAppCard(app) {
             const div = document.createElement('div');
             div.className = 'game';
             div.setAttribute('data-name', app.name);
             if (app.altNames && app.altNames.length > 0) {
                 div.setAttribute('data-names', [app.name, ...app.altNames].join(','));
             }
             const url = this.getAppUrl(app);
             const frameType = app.frameType || 'iframe';
             const framePage = frameType === 'unity' ? '/unityframe.html' : '/iframe.html';
             
             const mediaTag = app.mediaType === 'video' 
                 ? `<video src="${app.thumbnail}" autoplay muted loop playsinline class="game-thumbnail"></video>`
                 : `<img src="${app.thumbnail}" alt="${app.name}" class="game-thumbnail">`;
             div.innerHTML = `
                 <a href="${framePage}?url=${encodeURIComponent(url)}" class="game-link" data-name="${app.name}">
                 ${mediaTag}
                 </a>
             `;
             return div;
         }
         setupSearch() {
             const searchInput = document.getElementById('searchInput');
             const autocomplete = document.getElementById('autocomplete');
             if (!searchInput || !autocomplete) return;
             searchInput.addEventListener('input', (e) => {
                 const filter = e.target.value.toLowerCase().trim();
                 if (!filter) {
                     this.updateAppCount();
                     autocomplete.style.display = 'none';
                     this.showAllApps();
                     return;
                 }
                 const matches = this.findMatches(filter);
                 this.showSuggestions(matches, autocomplete);
                 this.updateAppCount(this.totalApps); 
             });
             searchInput.addEventListener('focus', () => {
                 if (!searchInput.value.trim()) {
                     const popularMatches = this.getPopularApps();
                     this.showSuggestions(popularMatches, autocomplete);
                 }
             });
             document.addEventListener('click', (e) => {
                 if (!autocomplete.contains(e.target) && e.target !== searchInput) {
                     autocomplete.style.display = 'none';
                 }
             });
         }
         findMatches(filter) {
             return this.apps.filter(app => {
                 const names = [app.name, ...(app.altNames || [])];
                 return names.some(name => name.toLowerCase().includes(filter));
             });
         }
         getPopularApps() {
             return this.apps.filter(app => 
                 this.popularApps.includes(app.name)
             );
         }
         showSuggestions(matches, autocomplete) {
             autocomplete.innerHTML = '';
             if (matches.length > 0) {
                 matches.forEach(match => {
                 const item = document.createElement('div');
                 item.className = 'autocomplete-item';                
                 const url = this.getAppUrl(match);
                 const frameType = match.frameType || 'iframe';
                 const framePage = frameType === 'unity' ? '/unityframe.html' : '/iframe.html';
                 
                 item.innerHTML = `
                     <img src="${match.thumbnail}" alt="${match.name}">
                     <span>${match.name}</span>
                 `;
                 item.onclick = () => window.location.href = `${framePage}?url=${encodeURIComponent(url)}`;
                 autocomplete.appendChild(item);
                 });
                 autocomplete.style.display = 'block';
             } else {
                 autocomplete.style.display = 'none';
             }
         }        
         showAllApps() {
             const appCards = document.querySelectorAll('.game-gallery .game');
             appCards.forEach(card => card.style.display = '');
         }
         updateAppCount(count = null) {
             const searchCount = document.getElementById('searchCount');
             if (!searchCount) return;
             if (count === null) {
                 searchCount.textContent = `Showing all ${this.totalApps} apps`;
             } else {
                 searchCount.textContent = `Showing all ${this.totalApps} apps`;
             }
         }
         showError(message) {
             const gallery = document.getElementById('gameGallery');
             if (gallery) {
                 gallery.innerHTML = `
                     <div style="color: white; text-align: center; padding: 2rem; width: 100%;">
                         <p>${message}</p>
                     </div>
                 `;
             }
         }
         }
         document.addEventListener('DOMContentLoaded', () => {
         const loader = new AppLoader();
         loader.init();
         });
      </script>
      <script>
         window.addEventListener('scroll', () => {
             const scrollY = window.scrollY;
             const offsetX = (scrollY * 0.1) % 50; 
             const offsetY = (scrollY * 0.1) % 50;
             document.body.style.setProperty('--scroll-offset-x', `${offsetX}px`);
             document.body.style.setProperty('--scroll-offset-y', `${offsetY}px`);
         });
         document.addEventListener('DOMContentLoaded', () => {
             const style = document.createElement('style');
             style.textContent = `
                 body::before {
                     background-position: var(--scroll-offset-x, 0px) var(--scroll-offset-y, 0px);
                 }
             `;
             document.head.appendChild(style);
         });
      </script>
   </body>
</html>